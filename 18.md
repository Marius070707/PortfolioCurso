------------Parte 1: Activación de .htaccess en Apache---------------
1.Editar el VirtualHost y localizar:

  <Directory /var/www/html>
     AllowOverride None
     Require all granted
  </Directory>

2.Cambiar None por All:

  AllowOverride All
  
3.Reiniciar Apache:

  sudo systemctl restart apache2

4.Crear un archivo /var/www/html/.htaccess con este contenido:

  AddDefaultCharset UTF-8

-------------Parte 2: Autenticación Básica con .htaccess---------------
1.Crear una carpeta /var/www/html/admin/ con un index.html.
2.Crear /var/www/html/.htpasswd generando un usuario:

  htpasswd -c /var/www/html/.htpasswd admin
  
3.Crear /var/www/html/admin/.htaccess:

  AuthType Basic
  AuthName "Zona restringida"
  AuthUserFile /var/www/html/.htpasswd
  Require valid-user

4.Entrar a http://servidor/admin y probar el acceso.

----------Parte 3: Gestión de Errores Personalizados------------

1.Crear 404.html y 403.html en la raíz.
2.Añadir en /var/www/html/.htaccess:

  ErrorDocument 404 /404.html
  ErrorDocument 403 /403.html
  
3.Probar introduciendo una URL inexistente.-

----------------Parte 4: Cabeceras de Seguridad---------------
Añadir en /var/www/html/.htaccess:

  Header set X-Frame-Options "DENY"
  Header set X-Content-Type-Options "nosniff"
  Header set X-XSS-Protection "1; mode=block"
  Header set Referrer-Policy "no-referrer-when-downgrade"
  Header set Permissions-Policy "geolocation=()"

--------------------Parte 5: Redirecciones HTTP---------------
1.Redirección permanente (301):

  Redirect 301 /viejo.html /nuevo.html
  
2.Temporal (302):

  Redirect 302 /promo /promo-2026

--------------------Parte 6: Reescritura de URLs con mod_rewrite-------------
6.1 Activación del módulo
Activar el módulo responsable de la reescritura:

  sudo a2enmod rewrite
  sudo systemctl restart apache2
  
Sin este módulo, las reglas de reescritura no funcionarán.

6.2 Requisito en el VirtualHost
Dentro del VirtualHost debe estar permitido el uso de .htaccess. En el bloque <Directory> debe existir:

  AllowOverride All
  
Si estuviera en None, Apache ignorará las reglas del .htaccess.

6.3 Ejemplo simple: eliminar extensión
Crear un archivo hola.html en el DocumentRoot (/var/www/html/).

Crear o editar el .htaccess en el mismo directorio con:

  RewriteEngine On
  RewriteRule ^hola$ hola.html [L]

6.4.1 Código
En el .htaccess del DocumentRoot:

  RewriteEngine On

  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.+)$ index.php?route=$1 [L,QSA]

6.5 Demostración práctica
Crear un archivo index.php con:

  <?php
  echo "Ruta solicitada: " . ($_GET['route'] ?? 'ninguna');
  ?>
  
Acceder desde el navegador a distintas rutas:

  http://servidor/productos
  http://servidor/usuarios/editar/7
  http://servidor/pepito
  
Salida esperada:

  Ruta solicitada: productos
  Ruta solicitada: usuarios/editar/7
  Ruta solicitada: pepito

Parte 7: Control del Listado de Directorios
Para evitar que se muestren archivos:

  Options -Indexes

--------------Parte 8: Forzar HTTPS-----------
Añadir:

  RewriteEngine On
  RewriteCond %{HTTPS} !=on
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

---------------Parte 9: Cacheo y Compresión---------------

Cache de archivos (si mod_expires activado):

  <IfModule mod_expires.c>
     ExpiresActive On
     ExpiresByType image/jpeg "access plus 30 days"
     ExpiresByType text/css "access plus 7 days"
     ExpiresByType application/javascript "access plus 7 days"
  </IfModule>
  
Compresión (si mod_deflate activado):

  SetOutputFilter DEFLATE


---------Parte 10: Interacción con Buscadores (SEO y Indexación)--------------

Crear en raíz del sitio:

  User-agent: *
  Disallow: /admin/
  Disallow: /backup/

En .htaccess:

  Header set X-Robots-Tag "noindex, nofollow"

-------------Parte 11: Ocultación y Restricción de Carpetas-----------------

Impedir acceso web a una carpeta:
Dentro de la carpeta crear .htaccess:

  Require all denied
  
O por archivo:

  <FilesMatch "\.(sql|bak|zip|tar)$">
     Require all denied
  </FilesMatch>
  
Restringir por IP:

  Require ip 192.168.1.0/24
  
Evitar ejecución de PHP en carpetas de subida:

  <FilesMatch "\.(php|phtml)$">
     Require all denied
  </FilesMatch>
