En esta actividad hemos aprendido cómo funciona el cifrado asimétrico usando
una clave pública y una clave privada. Cada persona tiene dos claves: la pública
se puede compartir con cualquiera y la privada debe mantenerse en secreto.
Vimos que si alguien cifra un mensaje con la clave pública, solo la persona que 
tiene la clave privada puede leerlo, lo que permite enviar información de forma segura.

También probamos a crear claves y a cifrar y descifrar mensajes para entender mejor 
el proceso. Aprendimos además qué es una firma digital, que sirve para comprobar quién 
envió un mensaje y que no ha sido modificado. Finalmente vimos que este sistema se usa 
en Internet todos los días, por ejemplo en páginas HTTPS, para proteger nuestras comunicaciones.

Para crear una identidad criptográfica:

  openssl genrsa -out privada.pem 2048
  openssl rsa -in privada.pem -pubout -out publica.pem

FASE 1 — Crear carpeta de misión

mkdir-p mision_canal_seguro && cd mision_canal_seguro

FASE 2 — Generar clave privada del oficial Bob 

openssl genrsa -out bob_privada.pem 2048
Comprobación rápida:

openssl rsa -in bob_privada.pem -check-noout

FASE 3 — Obtener la clave pública de Bob
Narrativa: esta es la clave que Bob puede compartir con toda la Flota.

openssl rsa -in bob_privada.pem -pubout-out bob_publica.pem
Verla en modo humano:

openssl rsa -pubin-in bob_publica.pem -text-noout

FASE 4 — Crear mensaje secreto de Alice
echo "Coordenadas del punto de encuentro: Sector 7G. Acceso nivel Alfa." > mensaje_alice.txt
cat mensaje_alice.txt

FASE 5 — Cifrar para Bob usando su clave pública
IMPORTANTE (realidad): RSA no se usa para cifrar grandes datos. Aquí lo usamos con un mensaje pequeño para entender el concepto.

openssl pkeyutl -encrypt -pubin -inkey bob_publica.pem -in mensaje_alice.txt -out mensaje_para_bob.bin
Ver que es ilegible:

xxd mensaje_para_bob.bin | head

FASE 6 — Descifrar con la clave privada de Bob
openssl pkeyutl -decrypt -inkey bob_privada.pem -in mensaje_para_bob.bin -out mensaje_descifrado.txt
cat mensaje_descifrado.txt

FASE 7 — Alice firma un mensaje
Primero Alice genera sus claves (identidad propia):

openssl genrsa -out alice_privada.pem 2048
openssl rsa -in alice_privada.pem -pubout -out alice_publica.pem
Mensaje oficial:
openssl dgst -sha256 -sign alice_privada.pem -out orden.firma orden.txt

FASE 8 — Crear el hash y firmarlo (firma con clave privada)
openssl dgst -sha256-sign alice_privada.pem -out orden.firma orden.txt

FASE 9 — Verificar la firma con la clave pública
openssl dgst -sha256-verify alice_publica.pem -signature orden.firma orden.txt
Resultado esperado: Verified OK

FASE 10 — Simular sabotaje (modificación del mensaje)
echo "Orden de misión: desactivar escudos y abrir bahía de carga." > orden.txt
openssl dgst -sha256 -verify alice_publica.pem -signature orden.firma orden.txt

FASE 11 — Crear la CA de la Flota Estelar
CA = Autoridad de Certificación (el “notario” criptográfico).

Clave privada de la CA:

openssl genrsa -out starfleet_ca_privada.pem 4096

Certificado autofirmado de la CA (válido 365 días):
openssl req -x509 -new -key starfleet_ca_privada.pem -sha256 -days 365 -out starfleet_ca.crt \
-subj "/C=ES/O=Starfleet Academy/OU=Security Division/CN=Starfleet Root CA"

FASE 12 — Alice solicita un certificado (CSR)
CSR = Certificate Signing Request (petición de certificado).

openssl req -x509 -new -key starfleet_ca_privada.pem -sha256 -days 365 -out starfleet_ca.crt \
-subj "/C=ES/O=Starfleet Academy/OU=Security Division/CN=Starfleet Root CA"

FASE 13 — La CA firma el certificado de Alice
openssl x509 -req -in alice.csr -CA starfleet_ca.crt -CAkey starfleet_ca_privada.pem \
-CAcreateserial -out alice_cert.crt -days 365 -sha256

FASE 14 — Verificar que el certificado de Alice “cuelga” de la CA
openssl verify -CAfile starfleet_ca.crt alice_cert.crt
