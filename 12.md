Instalamos las herramientas base (curl, unzip, jq y python3)

  sudo apt -y install curl unzip jq ca-certificates gnupg python3 python3-venv python3-pip

Configuramos hostname y comprobamos

  sudo hostnamectl set-hostname forense-ai
  hostnamectl

Instalamos y probamos Ollama

  curl -fsSL https://ollama.com/install.sh | sh
  sudo systemctl status ollama --no-pager

Descargamos modelo ligero y probamos que funcione con

  ollama pull phi3
  ollama run phi3 "Resume en 5 líneas qué es una auditoría de sistemas."

Instalamos Apache y PHP  

  sudo apt -y install apache2 php libapache2-mod-php
  sudo systemctl enable --now apache2

Abrimos firewall

  sudo ufw allow 'Apache'
  sudo ufw status

Y comprobamos acceso a la web 

  http://IP_DEL_SERVIDOR/

Creamos la carpeta 

  sudo mkdir -p /var/www/forense-ai/{uploads,results,scripts,logs}
  sudo chown -R www-data:www-data /var/www/forense-ai
  sudo chmod -R 750 /var/www/forense-ai

Creamos VirtualHost

  sudo nano /etc/apache2/sites-available/forense-ai.conf

Pegamos esto 

  <VirtualHost *:80>
    ServerName forense-ai.local
    DocumentRoot /var/www/forense-ai

    <Directory /var/www/forense-ai>
        Options -Indexes
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/forense-ai_error.log
    CustomLog ${APACHE_LOG_DIR}/forense-ai_access.log combined
  </VirtualHost>

Activamos el sitio:

  sudo a2ensite forense-ai
  sudo a2dissite 000-default
  sudo systemctl reload apache2

Instalamos herramientas para extraer texto de PDF

  sudo apt -y install poppler-utils

Creamos el formulario 

  sudo nano /var/www/forense-ai/index.php

Contenido

  <?php
$maxSize = 8 * 1024 * 1024; // 8 MB
$allowed = ['txt','log','pdf'];

function safe_name($name) {
  $name = preg_replace('/[^a-zA-Z0-9._-]/', '_', $name);
  return $name;
}

?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Forense-AI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; max-width: 900px; }
    .box { padding: 16px; border: 1px solid #ccc; border-radius: 8px; }
    input, textarea, select { width: 100%; padding: 8px; margin-top: 8px; }
    button { padding: 10px 14px; margin-top: 12px; }
    .small { color: #555; font-size: 0.9em; }
  </style>
</head>
<body>
  <h1>Forense-AI — Analizador de evidencias</h1>
  <div class="box">
    <form action="process.php" method="post" enctype="multipart/form-data">
      <label>Evidencia (TXT/LOG/PDF, máx 8 MB)</label>
      <input type="file" name="evidence" required>

      <label>Tipo de análisis</label>
      <select name="mode">
        <option value="audit">Auditoría (hallazgos y riesgos)</option>
        <option value="forensic">Forense (línea temporal y eventos)</option>
        <option value="summary">Resumen ejecutivo</option>
      </select>

      <label>Contexto (opcional)</label>
      <textarea name="context" rows="4" placeholder="Ej: Esto es un auth.log de un servidor SSH expuesto a Internet..."></textarea>

      <button type="submit">Subir y analizar</button>
      <p class="small">El análisis se realiza localmente en el servidor (Ollama). No se envía nada a Internet.</p>
    </form>
  </div>
</body>
</html>


Creamos  el script de procesamiento process.php

  sudo nano /var/www/forense-ai/process.php

Crea la página de resultados result.php

  sudo nano /var/www/forense-ai/result.php

Contenido

  <?php
$resultDir = __DIR__ . "/results/";
$f = $_GET['f'] ?? '';
$f = basename($f); // evita traversal
$path = $resultDir . $f;

if (!$f || !file_exists($path)) {
  http_response_code(404);
  exit("Report not found");
}

$txt = file_get_contents($path);
?>
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Resultado — Forense-AI</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; max-width: 900px; }
    pre { white-space: pre-wrap; border: 1px solid #ccc; padding: 16px; border-radius: 8px; }
    a { display:inline-block; margin-top: 12px; }
  </style>
</head>
<body>
  <h1>Informe generado</h1>
  <a href="download.php?f=<?php echo urlencode($f); ?>">Descargar informe</a>
  <pre><?php echo htmlspecialchars($txt); ?></pre>
  <a href="index.php">⬅ Volver</a>
</body>
</html>

Crea el descargador download.php
 
 sudo nano /var/www/forense-ai/download.php

Contenido

   <?php
$resultDir = __DIR__ . "/results/";
$f = $_GET['f'] ?? '';
$f = basename($f);
$path = $resultDir . $f;

if (!$f || !file_exists($path)) {
  http_response_code(404);
  exit("Not found");
}

header('Content-Type: text/markdown; charset=utf-8');
header('Content-Disposition: attachment; filename="' . $f . '"');
readfile($path);


IMPORTANTE- Permisos finales 

  sudo chown -R www-data:www-data /var/www/forense-ai
  sudo find /var/www/forense-ai -type d -exec chmod 750 {} \;
  sudo find /var/www/forense-ai -type f -exec chmod 640 {} \;
  sudo systemctl reload apache2
